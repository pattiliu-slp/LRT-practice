<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lexical Retrieval Practice</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #EFF6FF 0%, #E0E7FF 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }
        h1 { font-size: 2.5rem; color: #1F2937; margin-bottom: 8px; }
        h2 { font-size: 1.5rem; color: #1F2937; margin-bottom: 16px; }
        h3 { font-size: 1.25rem; color: #1F2937; margin-bottom: 12px; }
        .subtitle { color: #6B7280; margin-bottom: 24px; }
        .form-group { margin-bottom: 16px; }
        label {
            display: block;
            font-weight: 500;
            color: #374151;
            margin-bottom: 4px;
            font-size: 0.875rem;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #D1D5DB;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus { outline: none; border-color: #4F46E5; }
        input[type="file"] { display: none; }
        .upload-button {
            display: block;
            width: 100%;
            padding: 12px;
            background: #EEF2FF;
            border: 2px dashed #818CF8;
            border-radius: 8px;
            color: #4F46E5;
            font-weight: 500;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        .upload-button:hover { background: #E0E7FF; border-color: #6366F1; }
        .upload-preview { margin-top: 12px; display: none; }
        .upload-preview img {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 8px;
            border: 2px solid #818CF8;
        }
        .button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .button:disabled { opacity: 0.5; cursor: not-allowed; }
        .button-primary { background: #4F46E5; color: white; }
        .button-primary:hover:not(:disabled) { background: #4338CA; }
        .button-success { background: #10B981; color: white; }
        .button-success:hover:not(:disabled) { background: #059669; }
        .button-secondary { background: #E5E7EB; color: #374151; }
        .button-secondary:hover:not(:disabled) { background: #D1D5DB; }
        .speak-button {
            background: #8B5CF6;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 16px;
        }
        .speak-button:hover { background: #7C3AED; }
        .word-list { display: grid; gap: 16px; margin-bottom: 24px; }
        .word-item {
            background: linear-gradient(135deg, #EEF2FF 0%, #F3E8FF 100%);
            border: 2px solid #C7D2FE;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .word-content { display: flex; align-items: center; gap: 16px; flex: 1; }
        .word-thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #818CF8;
            background: #F3F4F6;
        }
        .word-info { flex: 1; }
        .word-text {
            font-weight: bold;
            font-size: 1.25rem;
            color: #1F2937;
            margin-bottom: 4px;
        }
        .word-source { font-size: 0.75rem; color: #6B7280; }
        .icon-button {
            padding: 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 1rem;
            background: #FEE2E2;
            color: #EF4444;
        }
        .icon-button:hover { background: #FECACA; }
        .progress-bar {
            background: #E5E7EB;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        .progress-fill {
            background: #4F46E5;
            height: 100%;
            transition: width 0.3s;
        }
        .practice-image {
            width: 100%;
            max-width: 100%;
            max-height: 500px;
            object-fit: contain;
            background: #F9FAFB;
            border-radius: 16px;
            border: 4px solid #818CF8;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 16px;
            display: block;
        }
        .letter-cue {
            display: inline-block;
            background: linear-gradient(135deg, #EEF2FF, #E0E7FF);
            padding: 48px 64px;
            border-radius: 16px;
            border: 4px solid #818CF8;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .letter-cue-text {
            font-size: 6rem;
            font-weight: bold;
            background: linear-gradient(135deg, #4F46E5, #7C3AED);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .word-reveal {
            display: inline-block;
            background: linear-gradient(135deg, #D1FAE5, #A7F3D0);
            padding: 48px 64px;
            border-radius: 16px;
            border: 4px solid #34D399;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .word-reveal-text {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(135deg, #059669, #047857);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .writing-input { font-size: 1.5rem; padding: 16px; }
        .writing-fields {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 16px;
        }
        .writing-field-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .writing-field-label {
            font-size: 1rem;
            font-weight: 600;
            color: #4F46E5;
        }
        .feedback {
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
            font-size: 1.125rem;
        }
        .feedback-correct {
            background: #D1FAE5;
            color: #047857;
            border: 2px solid #34D399;
        }
        .feedback-incorrect {
            background: #FED7AA;
            color: #C2410C;
            border: 2px solid #FB923C;
        }
        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 32px;
        }
        .text-center { text-align: center; }
        .hidden { display: none; }
        .results-list { display: flex; flex-direction: column; gap: 8px; }
        .result-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .emoji { font-size: 3rem; margin-bottom: 16px; }
        .tab-buttons { display: flex; gap: 8px; margin-bottom: 16px; }
        .tab-button {
            flex: 1;
            padding: 12px;
            border: 2px solid #D1D5DB;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        .tab-button.active {
            background: #4F46E5;
            color: white;
            border-color: #4F46E5;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .card { padding: 20px; }
            .letter-cue-text { font-size: 4rem; }
            .word-reveal-text { font-size: 3rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="setupScreen">
            <div class="card">
                <h1>Lexical Retrieval Practice</h1>
                <p class="subtitle">Add 1-25 words with images for practice.</p>
                <div style="background: #F3F4F6; padding: 24px; border-radius: 8px; margin-bottom: 24px;">
                    <h3>Add New Word</h3>
                    <div class="form-group">
                        <label>Word</label>
                        <input type="text" id="wordInput" placeholder="e.g., hammer">
                    </div>
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="switchTab('upload')">üìÅ Upload Image</button>
                        <button class="tab-button" onclick="switchTab('url')">üîó Paste URL</button>
                    </div>
                    <div id="uploadTab" class="tab-content active">
                        <div class="form-group">
                            <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(event)">
                            <label for="imageUpload" class="upload-button">üì§ Click to Upload Image from Device</label>
                            <div id="uploadPreview" class="upload-preview">
                                <img id="previewImage" src="" alt="Preview">
                            </div>
                        </div>
                    </div>
                    <div id="urlTab" class="tab-content">
                        <div class="form-group">
                            <label>Image URL</label>
                            <input type="text" id="imageUrlInput" placeholder="Paste image URL here">
                        </div>
                    </div>
                    <button class="button button-primary" onclick="addWord()" style="width: 100%;">‚ûï Add Word</button>
                </div>
                <p style="color: #6B7280; font-size: 0.875rem; margin-bottom: 16px;">
                    <span id="wordCount">0</span> of 25 words added (minimum 1 required to start)
                </p>
                <div id="wordList" class="word-list"></div>
                <button id="startButton" class="button button-success hidden" onclick="startPractice()" style="width: 100%; font-size: 1.125rem; padding: 16px;">
                    ‚ñ∂Ô∏è Start Practice Session
                </button>
            </div>
        </div>

        <div id="practiceScreen" class="hidden">
            <div class="card">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; color: #6B7280; font-size: 0.875rem;">
                    <span>Word <span id="currentWordNum">1</span> of <span id="totalWords">0</span></span>
                    <span>Step <span id="currentStepNum">1</span> of 9</span>
                </div>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                </div>
            </div>
            <div class="card">
                <h2 id="stepTitle"></h2>
                <p id="stepInstruction" class="subtitle"></p>
                <div id="stepContent"></div>
                <div class="button-group">
                    <button id="prevButton" class="button button-secondary" onclick="previousStep()">‚¨ÖÔ∏è Previous</button>
                    <button id="nextButton" class="button button-primary" onclick="nextStep()">Next Step ‚û°Ô∏è</button>
                </div>
            </div>
            <div class="text-center">
                <button class="button button-secondary" onclick="exitPractice()">Exit Practice Session</button>
            </div>
        </div>

        <div id="completeScreen" class="hidden">
            <div class="card text-center">
                <div class="emoji">üéâ</div>
                <h1>Session Complete!</h1>
                <p class="subtitle">Great job completing your practice session.</p>
                <div style="background: #EFF6FF; border-radius: 8px; padding: 24px; margin: 24px 0;">
                    <h3>Your Results:</h3>
                    <div id="resultsList" class="results-list"></div>
                </div>
                <button class="button button-primary" onclick="backToHome()">Back to Home</button>
            </div>
        </div>
    </div>

    <script>
        let words = [];
        let currentIndex = 0;
        let currentStep = 0;
        let attempts = [];
        let userResponses = ['', '', ''];
        let finalResponse = '';
        let showFinalFeedback = false;
        let currentImageData = null;
        let activeTab = 'upload';

        const steps = [
            { id: 'image', title: 'Look at the Image', instruction: 'Study the image carefully. What do you see?' },
            { id: 'category', title: 'Think About Category', instruction: 'What category does this belong to?' },
            { id: 'features', title: 'Describe Features', instruction: 'What are the key features? Color, shape, use?' },
            { id: 'associations', title: 'Associations', instruction: 'What else does this make you think of?' },
            { id: 'first-letter', title: 'First Letter Cue', instruction: 'The word starts with:' },
            { id: 'verbal', title: 'Say the Word', instruction: 'Try to say the word out loud' },
            { id: 'reveal', title: 'Word Revealed', instruction: 'The word is:' },
            { id: 'writing', title: 'Writing Practice', instruction: 'Write the word three times:' },
            { id: 'final-test', title: 'Final Practice', instruction: 'Say the word out loud, then write it below:' }
        ];

        window.onload = function() {
            const saved = localStorage.getItem('lexicalWords');
            if (saved) {
                try {
                    words = JSON.parse(saved);
                    renderWordList();
                } catch (e) {
                    words = [];
                }
            }
        };

        function saveWords() {
            try {
                localStorage.setItem('lexicalWords', JSON.stringify(words));
            } catch (e) {
                alert('Unable to save words.');
            }
        }

        function switchTab(tab) {
            activeTab = tab;
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (tab === 'upload') {
                document.querySelector('.tab-button:first-child').classList.add('active');
                document.getElementById('uploadTab').classList.add('active');
            } else {
                document.querySelector('.tab-button:last-child').classList.add('active');
                document.getElementById('urlTab').classList.add('active');
            }
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentImageData = e.target.result;
                    document.getElementById('previewImage').src = currentImageData;
                    document.getElementById('uploadPreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        function addWord() {
            const wordInput = document.getElementById('wordInput');
            const imageUrlInput = document.getElementById('imageUrlInput');
            
            const word = wordInput.value.trim();
            let imageUrl = '';
            let imageSource = '';

            if (activeTab === 'upload' && currentImageData) {
                imageUrl = currentImageData;
                imageSource = 'Uploaded from device';
            } else if (activeTab === 'url' && imageUrlInput.value.trim()) {
                imageUrl = imageUrlInput.value.trim();
                imageSource = 'URL';
            }

            if (word && imageUrl && words.length < 25) {
                words.push({ text: word, imageUrl: imageUrl, source: imageSource });
                wordInput.value = '';
                imageUrlInput.value = '';
                currentImageData = null;
                document.getElementById('uploadPreview').style.display = 'none';
                document.getElementById('imageUpload').value = '';
                saveWords();
                renderWordList();
            } else if (!word) {
                alert('Please enter a word');
            } else if (!imageUrl) {
                alert('Please add an image');
            }
        }

        function removeWord(index) {
            if (confirm('Delete this word?')) {
                words.splice(index, 1);
                saveWords();
                renderWordList();
            }
        }

        function speakWord(word) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.rate = 0.8;
                window.speechSynthesis.speak(utterance);
            }
        }

        function renderWordList() {
            const wordList = document.getElementById('wordList');
            const wordCount = document.getElementById('wordCount');
            const startButton = document.getElementById('startButton');

            wordCount.textContent = words.length;
            startButton.classList.toggle('hidden', words.length < 1);

            if (words.length === 0) {
                wordList.innerHTML = '<p style="text-align: center; color: #6B7280; padding: 24px;">No words added yet</p>';
                return;
            }

            wordList.innerHTML = words.map((word, index) => `
                <div class="word-item">
                    <div class="word-content">
                        <img src="${word.imageUrl}" alt="${word.text}" class="word-thumbnail">
                        <div class="word-info">
                            <div class="word-text">${word.text}</div>
                            <div class="word-source">${word.source}</div>
                        </div>
                    </div>
                    <button class="icon-button" onclick="removeWord(${index})">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function startPractice() {
            currentIndex = 0;
            currentStep = 0;
            attempts = [];
            userResponses = ['', '', ''];
            finalResponse = '';
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('practiceScreen').classList.remove('hidden');
            renderPracticeStep();
        }

        function renderPracticeStep() {
            const currentWord = words[currentIndex];
            const step = steps[currentStep];

            document.getElementById('stepTitle').textContent = step.title;
            document.getElementById('stepInstruction').textContent = step.instruction;
            document.getElementById('currentWordNum').textContent = currentIndex + 1;
            document.getElementById('totalWords').textContent = words.length;
            document.getElementById('currentStepNum').textContent = currentStep + 1;

            const progress = ((currentIndex * steps.length + currentStep) / (words.length * steps.length)) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            const prevButton = document.getElementById('prevButton');
            prevButton.disabled = currentStep === 0;

            const stepContent = document.getElementById('stepContent');
            const nextButton = document.getElementById('nextButton');

            if (['image', 'category', 'features', 'associations', 'verbal'].includes(step.id)) {
                stepContent.innerHTML = `
                    <div class="text-center">
                        <img src="${currentWord.imageUrl}" alt="Visual stimulus" class="practice-image">
                        <p style="color: #4F46E5; font-weight: 500; margin-top: 16px;">üß† Study this image carefully</p>
                    </div>
                `;
                nextButton.textContent = 'Next Step ‚û°Ô∏è';
                nextButton.onclick = nextStep;
            } else if (step.id === 'first-letter') {
                stepContent.innerHTML = `
                    <div class="text-center">
                        <div class="letter-cue">
                            <div class="letter-cue-text">${currentWord.text.charAt(0).toUpperCase()}</div>
                        </div>
                        <p style="color: #6B7280; margin-top: 16px;">Use this letter as a cue</p>
                    </div>
                `;
                nextButton.textContent = 'Next Step ‚û°Ô∏è';
                nextButton.onclick = nextStep;
            } else if (step.id === 'reveal') {
                stepContent.innerHTML = `
                    <div class="text-center">
                        <div class="word-reveal">
                            <div class="word-reveal-text">${currentWord.text}</div>
                        </div>
                        <button class="button speak-button" id="speakButton">üîä Listen to Word</button>
                        <p style="color: #6B7280; margin-top: 16px;">Say this word out loud 3 times</p>
                    </div>
                `;
                setTimeout(() => {
                    const btn = document.getElementById('speakButton');
                    if (btn) btn.onclick = () => speakWord(currentWord.text);
                }, 0);
                nextButton.textContent = 'Next Step ‚û°Ô∏è';
                nextButton.onclick = nextStep;
            } else if (step.id === 'writing') {
                stepContent.innerHTML = `
                    <div>
                        <div class="text-center" style="margin-bottom: 24px;">
                            <span style="font-size: 2.5rem; font-weight: bold; color: #374151;">${currentWord.text}</span>
                        </div>
                        <div class="writing-fields">
                            <div class="writing-field-group">
                                <label class="writing-field-label">1. Write the word:</label>
                                <input type="text" id="writingInput1" class="writing-input" placeholder="Type the word here..." autocomplete="off">
                            </div>
                            <div class="writing-field-group">
                                <label class="writing-field-label">2. Write the word again:</label>
                                <input type="text" id="writingInput2" class="writing-input" placeholder="Type the word here..." autocomplete="off">
                            </div>
                            <div class="writing-field-group">
                                <label class="writing-field-label">3. Write the word one more time:</label>
                                <input type="text" id="writingInput3" class="writing-input" placeholder="Type the word here..." autocomplete="off">
                            </div>
                        </div>
                    </div>
                `;
                setTimeout(() => {
                    document.getElementById('writingInput1').focus();
                    ['writingInput1', 'writingInput2', 'writingInput3'].forEach((id, idx) => {
                        const input = document.getElementById(id);
                        if (input) {
                            input.value = userResponses[idx] || '';
                            input.addEventListener('input', (e) => {
                                userResponses[idx] = e.target.value;
                            });
                        }
                    });
                }, 0);
                nextButton.textContent = 'Next Step ‚û°Ô∏è';
                nextButton.onclick = nextStep;
            } else if (step.id === 'final-test') {
                stepContent.innerHTML = `
                    <div>
                        <div class="text-center" style="margin-bottom: 24px;">
                            <img src="${currentWord.imageUrl}" alt="Visual stimulus" class="practice-image" style="max-height: 350px;">
                        </div>
                        <input type="text" id="finalInput" class="writing-input" placeholder="Type the word here..." autocomplete="off" style="font-size: 1.8rem;">
                        <div id="finalFeedbackDiv"></div>
                    </div>
                `;
                setTimeout(() => {
                    const finalInput = document.getElementById('finalInput');
                    finalInput.focus();
                    finalInput.value = finalResponse || '';
                    finalInput.addEventListener('input', (e) => {
                        finalResponse = e.target.value;
                        if (showFinalFeedback) {
                            showFinalFeedback = false;
                            document.getElementById('finalFeedbackDiv').innerHTML = '';
                            nextButton.textContent = 'Check';
                        }
                    });
                }, 0);

                nextButton.textContent = 'Check';
                nextButton.onclick = () => {
                    if (!showFinalFeedback) {
                        showFinalFeedback = true;
                        const isCorrect = finalResponse.toLowerCase().trim() === currentWord.text.toLowerCase().trim();
                        const feedbackDiv = document.getElementById('finalFeedbackDiv');
                        
                        if (isCorrect) {
                            feedbackDiv.innerHTML = '<div class="feedback feedback-correct">‚úì Correct!</div>';
                        } else {
                            feedbackDiv.innerHTML = `<div class="feedback feedback-incorrect">The correct answer is: ${currentWord.text}</div>`;
                        }
                        
                        attempts.push({
                            word: currentWord.text,
                            written: finalResponse,
                            correct: isCorrect
                        });
                        
                        nextButton.textContent = 'Continue ‚û°Ô∏è';
                    } else {
                        finalResponse = '';
                        showFinalFeedback = false;
                        userResponses = ['', '', ''];
                        nextStep();
                    }
                };
            }
        }

        function nextStep() {
            if (currentStep < steps.length - 1) {
                currentStep++;
                renderPracticeStep();
            } else {
                if (currentIndex < words.length - 1) {
                    currentIndex++;
                    currentStep = 0;
                    renderPracticeStep();
                } else {
                    showComplete();
                }
            }
        }

        function previousStep() {
            if (currentStep > 0) {
                currentStep--;
                renderPracticeStep();
            }
        }

        function exitPractice() {
            if (confirm('Exit session? Progress will not be saved.')) {
                document.getElementById('practiceScreen').classList.add('hidden');
                document.getElementById('setupScreen').classList.remove('hidden');
            }
        }

        function showComplete() {
            document.getElementById('practiceScreen').classList.add('hidden');
            document.getElementById('completeScreen').classList.remove('hidden');

            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = attempts.map(attempt => `
                <div class="result-item">
                    <span style="color: #374151; font-weight: 500;">${attempt.word}</span>
                    <span style="color: ${attempt.correct ? '#059669' : '#EA580C'}; font-weight: 600;">
                        ${attempt.correct ? '‚úì Correct' : '‚úó ' + attempt.written}
                    </span>
                </div>
            `).join('');
        }

        function backToHome() {
            document.getElementById('completeScreen').classList.add('hidden');
            document.getElementById('setupScreen').classList.remove('hidden');
            currentIndex = 0;
            currentStep = 0;
            attempts = [];
        }
    </script>
</body>
</html>